<!DOCTYPE html>
<html  lang="french">

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Krigeage avec R</title>
  <meta name="description" content="Krigeage avec R">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Krigeage avec R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Krigeage avec R" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  

<link rel="next" href="utilisation-de-fonds-de-carte.html">
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="interpolation-et-cartographie-locales.html"><a href="interpolation-et-cartographie-locales.html"><i class="fa fa-check"></i><b>1</b> Interpolation et cartographie locales</a><ul>
<li class="chapter" data-level="1.1" data-path="interpolation-et-cartographie-locales.html"><a href="interpolation-et-cartographie-locales.html#creation-des-donnees"><i class="fa fa-check"></i><b>1.1</b> Création des données</a></li>
<li class="chapter" data-level="1.2" data-path="interpolation-et-cartographie-locales.html"><a href="interpolation-et-cartographie-locales.html#cartographie"><i class="fa fa-check"></i><b>1.2</b> Cartographie</a><ul>
<li class="chapter" data-level="1.2.1" data-path="interpolation-et-cartographie-locales.html"><a href="interpolation-et-cartographie-locales.html#akima"><i class="fa fa-check"></i><b>1.2.1</b> akima</a></li>
<li class="chapter" data-level="1.2.2" data-path="interpolation-et-cartographie-locales.html"><a href="interpolation-et-cartographie-locales.html#spatial"><i class="fa fa-check"></i><b>1.2.2</b> spatial</a></li>
<li class="chapter" data-level="1.2.3" data-path="interpolation-et-cartographie-locales.html"><a href="interpolation-et-cartographie-locales.html#gstat"><i class="fa fa-check"></i><b>1.2.3</b> gstat</a></li>
<li class="chapter" data-level="1.2.4" data-path="interpolation-et-cartographie-locales.html"><a href="interpolation-et-cartographie-locales.html#automap"><i class="fa fa-check"></i><b>1.2.4</b> automap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="utilisation-de-fonds-de-carte.html"><a href="utilisation-de-fonds-de-carte.html"><i class="fa fa-check"></i><b>2</b> Utilisation de fonds de carte</a><ul>
<li class="chapter" data-level="2.1" data-path="utilisation-de-fonds-de-carte.html"><a href="utilisation-de-fonds-de-carte.html#obtention-des-cartes"><i class="fa fa-check"></i><b>2.1</b> Obtention des cartes</a></li>
<li class="chapter" data-level="2.2" data-path="utilisation-de-fonds-de-carte.html"><a href="utilisation-de-fonds-de-carte.html#fabrication-des-donnees"><i class="fa fa-check"></i><b>2.2</b> Fabrication des données</a></li>
<li class="chapter" data-level="2.3" data-path="utilisation-de-fonds-de-carte.html"><a href="utilisation-de-fonds-de-carte.html#interpolation"><i class="fa fa-check"></i><b>2.3</b> Interpolation</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Krigeage avec R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Krigeage avec R</h1>
<h4 class="author"><em>Eric Marcon</em></h4>
<h4 class="date"><em>28 octobre 2018</em></h4>
<div class="abstract">
<p class="abstract">Abstract</p>
<p>Techniques pour interpoler les valeurs d’une variable continue.</p>
</div>
</div>
<div id="interpolation-et-cartographie-locales" class="section level1">
<h1><span class="header-section-number">1</span> Interpolation et cartographie locales</h1>
<div id="creation-des-donnees" class="section level2">
<h2><span class="header-section-number">1.1</span> Création des données</h2>
<p>Création d’une communauté de 100 individus de 10 espèces dans une placettes carrée de 1x1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;SpatDiv&quot;</span>)
<span class="kw">plot</span>(spCommunity &lt;-<span class="st"> </span><span class="kw">rSpCommunity</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">100</span>, 
    <span class="dt">S =</span> <span class="dv">10</span>), <span class="dt">which.marks =</span> <span class="st">&quot;PointType&quot;</span>)</code></pre></div>
<p><img src="Krigeage_files/figure-html/data-1.png" width="\maxwidth" /></p>
<p>Calcul de la SAC en fonction du nombre de voisins.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">divAccum &lt;-<span class="st"> </span><span class="kw">DivAccum</span>(spCommunity, <span class="dt">n.seq =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">q.seq =</span> <span class="dv">0</span>, 
    <span class="dt">Individual =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## ==================================================</code></pre>
</div>
<div id="cartographie" class="section level2">
<h2><span class="header-section-number">1.2</span> Cartographie</h2>
<div id="akima" class="section level3">
<h3><span class="header-section-number">1.2.1</span> akima</h3>
<p>La méthode d’Akima est une interpolation entre les valeurs des points, faite dans chaque triangle constitué par les triplets de points les plus proches. La valeur des points est conservée. L’interpolation se limite au polygone convexe contenant les points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;akima&quot;</span>)
Interpole &lt;-<span class="st"> </span><span class="kw">with</span>(divAccum, <span class="kw">interp</span>(<span class="dt">x =</span> SpCommunity<span class="op">$</span>x, 
    <span class="dt">y =</span> SpCommunity<span class="op">$</span>y, <span class="dt">z =</span> Neighborhoods[<span class="st">&quot;0&quot;</span>, <span class="st">&quot;10&quot;</span>, 
        ], <span class="dt">xo =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">0.01</span>), <span class="dt">yo =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, 
        <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)))
<span class="kw">image</span>(Interpole, <span class="dt">col =</span> <span class="kw">topo.colors</span>(<span class="dv">128</span>, <span class="dt">alpha =</span> <span class="dv">1</span>), 
    <span class="dt">asp =</span> <span class="dv">1</span>)
<span class="kw">contour</span>(Interpole, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">with</span>(divAccum, <span class="kw">points</span>(<span class="dt">x =</span> SpCommunity<span class="op">$</span>x, <span class="dt">y =</span> SpCommunity<span class="op">$</span>y, 
    <span class="dt">pch =</span> <span class="dv">20</span>))</code></pre></div>
<p><img src="Krigeage_files/figure-html/Akima-1.png" width="\maxwidth" /></p>
</div>
<div id="spatial" class="section level3">
<h3><span class="header-section-number">1.2.2</span> spatial</h3>
<p>La librairie <em>spatial</em> permet krieger, mais renvoie des erreurs si la méthode de calcul de la covariance n’est pas exponentielle. L’ordre du polynome du modèle et la distance de dépendance doivent être choisis explicitement.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;spatial&quot;</span>)
Carte &lt;-<span class="st"> </span><span class="kw">with</span>(divAccum, <span class="kw">surf.gls</span>(<span class="dt">np =</span> <span class="dv">3</span>, <span class="dt">covmod =</span> expcov, 
    <span class="dt">x =</span> SpCommunity<span class="op">$</span>x, <span class="dt">y =</span> SpCommunity<span class="op">$</span>y, <span class="dt">z =</span> Neighborhoods[<span class="st">&quot;0&quot;</span>, 
        <span class="st">&quot;10&quot;</span>, ], <span class="dt">d =</span> <span class="fl">0.5</span>))
Krieg &lt;-<span class="st"> </span><span class="kw">prmat</span>(Carte, <span class="dt">xl =</span> <span class="dv">0</span>, <span class="dt">xu =</span> <span class="dv">1</span>, <span class="dt">yl =</span> <span class="dv">0</span>, <span class="dt">yu =</span> <span class="dv">1</span>, 
    <span class="dt">n =</span> <span class="dv">128</span>)
<span class="kw">image</span>(Krieg, <span class="dt">col =</span> <span class="kw">topo.colors</span>(<span class="dv">128</span>, <span class="dt">alpha =</span> <span class="dv">1</span>), <span class="dt">asp =</span> <span class="dv">1</span>)
<span class="kw">contour</span>(Krieg, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">with</span>(divAccum, <span class="kw">points</span>(<span class="dt">x =</span> SpCommunity<span class="op">$</span>x, <span class="dt">y =</span> SpCommunity<span class="op">$</span>y, 
    <span class="dt">pch =</span> <span class="dv">20</span>))</code></pre></div>
<p><img src="Krigeage_files/figure-html/spatial-1.png" width="\maxwidth" /></p>
</div>
<div id="gstat" class="section level3">
<h3><span class="header-section-number">1.2.3</span> gstat</h3>
<p>La librairie <em>gstat</em> étend les possibilités de kriegeage en permettant de spécifier un modèle de tendance pour la variable cartographiée (inutile ici, on utilise <code>formula=Richness~1</code>). Le variogramme doit être calculé et un modèle ajusté (dans l’exemple, un modèle gaussien et non exponentiel).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;sp&quot;</span>)
<span class="co"># Création d&#39;un SpatialPointsDataFrame avec les</span>
<span class="co"># données</span>
sdfCommunity &lt;-<span class="st"> </span><span class="kw">with</span>(divAccum, <span class="kw">SpatialPointsDataFrame</span>(<span class="dt">coords =</span> <span class="kw">data.frame</span>(<span class="dt">x =</span> SpCommunity<span class="op">$</span>x, 
    <span class="dt">y =</span> SpCommunity<span class="op">$</span>y), <span class="dt">data =</span> <span class="kw">data.frame</span>(<span class="dt">Richness =</span> Neighborhoods[<span class="st">&quot;0&quot;</span>, 
    <span class="st">&quot;10&quot;</span>, ])))
<span class="kw">library</span>(<span class="st">&quot;gstat&quot;</span>)
<span class="co"># Variogramme empirique</span>
vgmEmpirique &lt;-<span class="st"> </span>gstat<span class="op">::</span><span class="kw">variogram</span>(Richness <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> sdfCommunity)
<span class="co"># Ajustement d&#39;un modèle gaussien</span>
vgmX &lt;-<span class="st"> </span><span class="kw">fit.variogram</span>(vgmEmpirique, <span class="kw">vgm</span>(<span class="st">&quot;Gau&quot;</span>))
<span class="co"># Objet geostat qui décrit toutes les</span>
<span class="co"># caractéristiques de la modélisation. La formule</span>
<span class="co"># donne le modèle de tendance</span>
geoX &lt;-<span class="st"> </span><span class="kw">gstat</span>(<span class="dt">formula =</span> Richness <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">locations =</span> sdfCommunity, 
    <span class="dt">model =</span> vgmX)
<span class="co"># Préparation d&#39;une grille de 128 points de côté</span>
xy &lt;-<span class="st"> </span><span class="kw">expand.grid</span>((<span class="dv">0</span><span class="op">:</span><span class="dv">128</span>)<span class="op">/</span><span class="dv">128</span>, (<span class="dv">0</span><span class="op">:</span><span class="dv">128</span>)<span class="op">/</span><span class="dv">128</span>)
<span class="kw">names</span>(xy) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)
<span class="kw">gridded</span>(xy) &lt;-<span class="st"> </span><span class="er">~</span>x <span class="op">+</span><span class="st"> </span>y
<span class="co"># Calcul de la valeur de Richness sur les points de</span>
<span class="co"># la grille (kriegeage)</span>
geoXprd &lt;-<span class="st"> </span><span class="kw">predict</span>(geoX, <span class="dt">newdata =</span> xy)</code></pre></div>
<pre><code>## [using ordinary kriging]</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Carte</span>
<span class="kw">image</span>(geoXprd, <span class="dt">col =</span> <span class="kw">topo.colors</span>(<span class="dv">128</span>, <span class="dt">alpha =</span> <span class="dv">1</span>), <span class="dt">asp =</span> <span class="dv">1</span>)
<span class="kw">contour</span>(geoXprd, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">with</span>(divAccum, <span class="kw">points</span>(<span class="dt">x =</span> SpCommunity<span class="op">$</span>x, <span class="dt">y =</span> SpCommunity<span class="op">$</span>y, 
    <span class="dt">pch =</span> <span class="dv">20</span>))</code></pre></div>
<p><img src="Krigeage_files/figure-html/gstat-1.png" width="\maxwidth" /></p>
</div>
<div id="automap" class="section level3">
<h3><span class="header-section-number">1.2.4</span> automap</h3>
<p>La librairie <em>automap</em> s’appuie sur <em>gstat</em> mais automatise toutes les étapes de sélection du modèle de covariance (celui qui s’ajuste le mieux aux données est choisi). Le modèle sélectionné est affiché dans le variogramme. La grille précédente peut être utilisée, mais une grille calculée à partir de la fenêtre de l’objet <em>ppp</em> (librairie <em>spatstat</em>) est plutôt utilisée ici.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;spatstat&quot;</span>)
<span class="co"># Préparation d&#39;une grille de 128 points de côté</span>
xy &lt;-<span class="st"> </span><span class="kw">gridcentres</span>(spCommunity, <span class="dv">128</span>, <span class="dv">128</span>)
<span class="co"># Filtrage des noeuds de la grille à l&#39;intérieur de</span>
<span class="co"># la fenêtre (inutile ici)</span>
ok &lt;-<span class="st"> </span><span class="kw">inside.owin</span>(xy<span class="op">$</span>x, xy<span class="op">$</span>y, spCommunity)
<span class="co"># Formatage de la grille</span>
Grille &lt;-<span class="st"> </span><span class="kw">SpatialPoints</span>(<span class="kw">cbind</span>(xy<span class="op">$</span>x[ok], xy<span class="op">$</span>y[ok]))
<span class="kw">gridded</span>(Grille) &lt;-<span class="st"> </span><span class="ot">TRUE</span>
<span class="co"># Krigeage du SpatialPointsDataFrame créé à partir</span>
<span class="co"># des données précédemment</span>
<span class="kw">library</span>(<span class="st">&quot;automap&quot;</span>)
AutoKrige &lt;-<span class="st"> </span><span class="kw">autoKrige</span>(<span class="dt">formula =</span> Richness <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">input_data =</span> sdfCommunity, 
    <span class="dt">new_data =</span> Grille)</code></pre></div>
<pre><code>## [using ordinary kriging]</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Résultat du krigeage</span>
<span class="kw">plot</span>(AutoKrige)</code></pre></div>
<p><img src="Krigeage_files/figure-html/automap-1.png" width="\maxwidth" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Carte similaire aux précédentes</span>
<span class="kw">image</span>(AutoKrige<span class="op">$</span>krige_output, <span class="dt">col =</span> <span class="kw">topo.colors</span>(<span class="dv">128</span>, 
    <span class="dt">alpha =</span> <span class="dv">1</span>), <span class="dt">asp =</span> <span class="dv">1</span>)
<span class="kw">contour</span>(AutoKrige<span class="op">$</span>krige_output, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">with</span>(divAccum, <span class="kw">points</span>(<span class="dt">x =</span> SpCommunity<span class="op">$</span>x, <span class="dt">y =</span> SpCommunity<span class="op">$</span>y, 
    <span class="dt">pch =</span> <span class="dv">20</span>))</code></pre></div>
<p><img src="Krigeage_files/figure-html/automap-2.png" width="\maxwidth" /></p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>

<a href="utilisation-de-fonds-de-carte.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": [["Krigeage.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
